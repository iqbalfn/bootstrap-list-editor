{"version":3,"file":"bootstrap-list-editor.js","sources":["../../src/js/list-editor.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap List Editor (v0.0.1): list-editor.js\n * --------------------------------------------------------------------------\n */\n\nimport $ from 'jquery'\n\nconst Default = {\n    editor: null,\n    list  : null,\n    model : null,\n    items : {\n        title : 'title',\n        info  : [], // [{field,icon,title},...],\n        action: [], // { edit: {icon,title}, remove: {icon,title}}\n    }\n}\n\nclass ListEditor {\n\n    constructor(config){\n        this._config    = this._getConfig(config)\n        this._value     = '[]'\n        this._el        = {\n            editor : document.querySelector(this._config.editor),\n            list   : document.querySelector(this._config.list),\n            model  : document.querySelector(this._config.model)\n        }\n        this._activeIndex = null\n\n        this._addElementsListener()\n        this._redrawItems();\n    }\n\n    // private\n\n    _addElementsListener(){\n        this._el.model.addEventListener('change', e => this._redrawItems())\n\n        this._el.editor.addEventListener('submit', e => {\n            e.preventDefault()\n\n            let value = {}\n            let fInput = null\n            for(let i=0; i<this._el.editor.elements.length; i++){\n                let input = this._el.editor.elements[i]\n                if(input.type === 'button')\n                    continue\n                value[ input.name ] = input.value\n                input.value = ''\n                if(!fInput)\n                    fInput = input\n            }\n\n            if(this._activeIndex){\n                this._value[this._activeIndex] = value\n                this._el.model.value = JSON.stringify(this._value)\n                this._redrawItems()\n            }else{\n                this._drawItem(value, this._value.length)\n                this._updateModel()\n            }\n\n            this._activeIndex = null\n\n            if(fInput)\n                fInput.focus()\n        })\n\n        $(this._el.list)\n        .on('click', '.btn-remove', e => {\n            e.preventDefault()\n            let list = e.target.closest('.list-editor-item')\n            $(list).slideUp(f => {\n                $(list).remove()\n                this._updateModel()\n            })\n        })\n        .on('click', '.btn-edit', e => {\n            e.preventDefault()\n            let list  = e.target.closest('.list-editor-item')\n            let item  = JSON.parse(list.dataset.object)\n            this._activeIndex = list.dataset.index\n\n            let fInput = null\n            for(let i=0; i<this._el.editor.elements.length; i++){\n                let input = this._el.editor.elements[i]\n\n                if(input.type === 'button')\n                    continue\n                input.value = item[input.name] || ''\n                if(!fInput)\n                    fInput = input\n            }\n\n            fInput.select()\n            $('html, body').animate({\n                scrollTop: $(this._el.editor).offset().top\n            })\n        })\n    }\n\n    _drawItem(item, index){\n        let safe = {\n            object: this._hs( JSON.stringify(item) ),\n            title : item[ this._config.items.title ]\n        }\n\n        let infos = []\n        this._config.items.info.forEach(info => {\n            if(!item[info.field])\n                return\n\n            let safe = {\n                title: this._hs( info.title ),\n                text : this._hs( item[info.field] ),\n                icon : info.icon || ''\n            }\n\n            let tmpl = `\n                <span title=\"${safe.title}\">\n                    ${safe.icon}\n                    ${safe.text}\n                </span>`\n\n            infos.push(tmpl)\n        })\n        infos = infos.join('&middot;')\n\n        let actions = []\n        for(let k in this._config.items.action){\n            let action = this._config.items.action[k]\n            let safe   = {\n                class: 'btn-' + k,\n                icon : action.icon || '',\n                title: this._hs( action.title || '' )\n            }\n\n            let tmpl = `\n                <a href=\"#0\" class=\"btn btn-secondary ${safe.class}\" title=\"${safe.title}\">\n                    ${safe.icon}\n                </a>`\n\n            actions.push(tmpl)\n        }\n\n        actions = actions.join('')\n\n        let tmpl = `\n            <li class=\"list-group-item list-editor-item\" data-object=\"${safe.object}\" data-index=\"${index}\">\n                <div class=\"d-flex w-100 justify-content-between\">\n                    <h5 class=\"mb-1\">${safe.title}</h5>\n                    <div>\n                        <div class=\"btn-group btn-group-sm\" role=\"group\" aria-label=\"Action\">\n                            ${actions}\n                        </div>\n                    </div>\n                </div>\n                <small>${infos}</small>\n            </li>`\n\n        $(this._el.list).append(tmpl)\n    }\n\n    _getConfig(config){\n        let conf = {}\n        for(let k in Default){\n            if('items' === k){\n                conf[k] = {}\n                if(config[k]){\n                    for(let j in config[k])\n                        conf[k][j] = typeof config[k][j] === 'undefined' ? Default[k][j] : config[k][j]\n                }\n            }else{\n                conf[k] = typeof config[k] === 'undefined' ? Default[k] : config[k]\n            }\n        }\n\n        return conf\n    }\n\n    _hs(text){\n        return text\n          .replace(/&/g, \"&amp;\")\n          .replace(/</g, \"&lt;\")\n          .replace(/>/g, \"&gt;\")\n          .replace(/\"/g, \"&quot;\")\n          .replace(/'/g, \"&#039;\");\n    }\n\n    _redrawItems(){\n        this._value = this._el.model.value\n\n        try{\n            this._value = JSON.parse(this._value)\n        }catch(e){\n            this._value = []\n        }\n\n        this._el.list.innerHTML = ''\n        this._value.forEach((item,index) => this._drawItem(item,index))\n    }\n\n    _updateModel(){\n        let value = []\n\n        for(let i=0; i<this._el.list.children.length; i++){\n            let item = this._el.list.children[i]\n            value.push( JSON.parse(item.dataset.object) )\n        }\n\n        this._value = value\n        this._el.model.value = JSON.stringify(value)\n    }\n}\n\nwindow.ListEditor = ListEditor\nexport default ListEditor"],"names":["Default","editor","list","model","items","title","info","action","ListEditor","config","_config","_getConfig","_value","_el","document","querySelector","_activeIndex","_addElementsListener","_redrawItems","addEventListener","e","preventDefault","value","fInput","i","elements","length","input","type","name","JSON","stringify","_drawItem","_updateModel","focus","$","on","target","closest","slideUp","f","remove","item","parse","dataset","object","index","select","animate","scrollTop","offset","top","safe","_hs","infos","forEach","field","text","icon","tmpl","push","join","actions","k","append","conf","j","replace","innerHTML","children","window"],"mappings":"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"}